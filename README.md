# Face_Recognition_Avengers
Perform Face Recognition with FaceNet on Avengers Chris Evans, Mark Ruffalo, Chris Hemsworth, Robert Downey Jr, Scarlett Johansson.
Project uses SOTA Facial Recognition model purposed by Google named <b>FaceNet</b>. It uses deep convolutional networks along with triplet loss to achieve accuracy.

<b>MTCNN</b> (MultiTask Cascaded Convolutional Network) from the facenet-pytorch has been used to crop and align the faces.

# Overview/Approch
1. I have used pretrained FaceNet model (available at this link by Hiroki Taniai trained on MS-Celeb-1M dataset with model weights and architecture available at here). This model has input dimension of 160 * 160, while the output is an embedding vector of size 128.<br>
2. Used Triplet Loss as the loss function with margin = 0.9.<br>
3. Except the last Convolution2D block, I freezed all the blocks while trainng so that the weights can get acclimatized to the new data through some fine changes in weights of top block where complex features are learned (also callled fine tuning).<br>
4. Beforehand, we chose one image from each class as Anchor image and created their embeddings in train.py. This way we would prevent computing the embeddings of those images while performing face recognition of some test images.<br>
5. While testing for the test set, we compute the euclidean distance of embedding vector of each test image from the embedding vectors we have in our Anchor dictionary. If the lowest distance among all those 5 classes is less than some threshold (in our case it is threshold = 3.5), then the class having the lowest distance from the given test embedding vector is assigned to that vector (or person's image).<br>

# Requirements
 pytorch==1.8.1<br>
 facenet-pytorch<br>
 numpy<br>
 scikit-learn<br>
 tqdm<br>
 pillow<br>
 matplotlib<br>
 torchvision<br>
 torchaudio<br>
 cudatoolkit=10.2<br>
 
# Triplet Loss and Triplet Generator
Here we train the model such it learns the face embeddings f(x) from the image  such that the squared L2 distance between all faces of the same identity is small and the distance between a pair of faces from different identities is large.

This can be achieved with a triplet loss L as defined by
![image](https://user-images.githubusercontent.com/55848343/205446016-dadf873e-5561-4de5-915c-766d622848a3.png)

This loss minimizes the distance between an anchor image xa and a positive image xp and maximizes the between the anchor image xa and a negative image xn

The generate_triplets function generates these positive and negative images for the entire batch. The current implementation randomly chooses the positive and negative images from the current batch. This can easily be enhanced to select difficult triplets to make the model train better.

The difficult triplet can be generated by selecting the positive image having the highest distance from the anchor and similarly selcting the negative image having smallest distance from the anchor
<br>
# Live Working Link 
https://drive.google.com/drive/u/1/folders/1n229guZmQAaSDDH4uFVXoHqLu3nS2YsJ
# Visualizing Output
![output_38_12](https://user-images.githubusercontent.com/55848343/205446511-6cfdf772-7880-421d-8977-fb25a5a19529.jpg)
<br>Scarelett_Johansson with 94.83% probabilty

![output_38_2](https://user-images.githubusercontent.com/55848343/205446547-a74096c1-799e-464f-a585-20c4c59b8bbf.jpg)
<br>Chris_Hemsworth with 95.88% probabilty

![output_38_6](https://user-images.githubusercontent.com/55848343/205446645-7647e713-42ff-419a-b081-84f974f49aac.jpg)
<br>Mark_Ruffalo with 99.09% probabilty

![output_38_0](https://user-images.githubusercontent.com/55848343/205446672-cb823287-380e-49ac-a175-1a959699a266.jpg)
<br>Chris_Evans with 98.71% probabilty

![output_38_10](https://user-images.githubusercontent.com/55848343/205446696-28857544-3b1a-4f94-af33-4263bbb0d9d2.jpg)
<br>Robert_Downey with 99.05% probabilty
